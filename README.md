# **_ReferralAPI_**
RESTful API сервис для реферальной системы. Этот сервис предоставляет пользователям возможность зарегистрироваться самостоятельно или по реверальным кодам других пользователей. Пользователи могут создавать и просматривать свой реферальный код.                

Пользователи могут получить письмо на почту с кодом.                                        
Созданный код дополнительно кешируется.                                                       
Почта пользователя при регистрации проверяется на действительность.                                  

Стек: python, Django, Sqlite, Redis.                                           

**Доступ к API**
-----------
Для аутентификации используются JWT-токены. Зарегистрироваться может любой пользователь. Остальные запросы могут делать только аутентифицированные пользователи.

____
**Как запустить проект:**
-----------
Клонировать репозиторий и перейти в него в командной строке:

```
git clone https://github.com/TatianaSharova/ReferralAPI.git
```
**_Запуск через cmd:_**                                                 

1. Создать и активировать виртуальное окружение:

Для Linux/macOS:
```
python3 -m venv venv
```
```
source venv/bin/activate
```
Для Windows:
```
python -m venv venv
```
```
source venv/Scripts/activate
```
2. Создайте файл env. и наполните:
```
HUNTER_API_KEY = 'ваш API KEY от Hunter.io для подключения к их API'
EMAIL_HOST_USER = 'ваша почта, которая будет отсылать письма с кодами'
EMAIL_HOST_PASSWORD = 'пароль для приложения от gmail для использования почты'
```
Как получить EMAIL_HOST_PASSWORD можно посмотреть здесь: https://www.geeksforgeeks.org/setup-sending-email-in-django-project/

3. Установить зависимости из файла requirements.txt:
```
cd referalapi
```
```
pip install -r requirements.txt
```
4. Выполнить миграции:                                                            
Для Linux/macOS:
```
python3 manage.py migrate
```
Для Windows:
```
python manage.py migrate
```
5. Запустите Redis через Docker:
```
docker pull redis
docker run -d --name redis_container -p 6379:6379 redis
```
6. Запустить проект:          
Для Linux/macOS:
```
python3 manage.py runserver
```
Для Windows:
```
python manage.py runserver
```


**Регистрация пользователей:**                                               
После запуска проекта можно зарегистрировать новых пользователей, сделав POST запрос на endpoit:
```
http://127.0.0.1:8000/api/users/
```
Обязательными полями для регистрации явдяются: username, email и password. Необязательным полем является referral_code. Оно используется при регистрации по существующему реферальному коду другого юзера. При регистрации проверяется валидность почты через API Hunter.io.                                                                   
                                                                                   
Далее необходимо получить JWT токен, для этого необходимо сделать POST запрос на endpoit:
```
http://127.0.0.1:8000/api/auth/jwt/create/
```
Полученный access токен должен в дальнейшем использоваться в headers: {'Authorization': `Bearer ${token}`, ...}               
Когда access токен истечет, можно обновить его с помощью refresh токена, переданного в headers, при POST запросе на endpoit:
```
http://127.0.0.1:8000/api/auth/jwt/refresh/
```

**Создание реферального кода:**                                                      
У одного пользователя может быть только 1 реферальный код.
Для создания кода аутентифицированный пользователь должен отправить POST запрос на endpoit:
```
http://127.0.0.1:8000/api/code/
```
с полями code и live_days(срок действия кода). Как только истечет срок действия созданного кода, по нему будет невозможно зарегистрироваться.
     
Чтобы посмотреть свой код, надо отправить GET запрос на endpoint:
```
http://127.0.0.1:8000/api/code/
```
или
```
http://127.0.0.1:8000/api/code/id/
```
Также свой код можно удалять, DELETE запрос:
```
http://127.0.0.1:8000/api/code/id/
```
И редактировать, PATCH запрос:
```
http://127.0.0.1:8000/api/code/id/
``` 
**Получение своего реферального кода по почте:**                                          
Пользователь должен отправить GET запрос:
```
http://127.0.0.1:8000/api/send-code-email/
```

**Просмотр своих рефералов:**                                        
Чтобы посмотреть, кто зарегистрировался по твоему коду, надо сделать GET запрос:
```
http://127.0.0.1:8000/api/referals/
```
**Просмотр рефералов определенного пользователя:**                                  
Чтобы посмотреть, кто зарегистрировался по коду реферера, надо сделать GET запрос:
```
http://127.0.0.1:8000/api/referer/{user_id}/
```

**Документация:**                                      
Документацию к API после запуска проекта можно посмотреть по адресам:
```
http://127.0.0.1:8000/schema/redoc/
```
```
http://127.0.0.1:8000/schema/swagger-ui/
```

### Автор
[Татьяна Шарова](https://github.com/TatianaSharova)